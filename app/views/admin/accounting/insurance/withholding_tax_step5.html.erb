<div class="p-6">
  <!-- パンくずナビゲーション -->
  <div class="mb-6">
    <%= link_to "社会保険・税務管理", admin_accounting_insurance_index_path, class: "text-blue-600 hover:text-blue-800" %>
    <span class="text-gray-400 mx-2">/</span>
    <span class="text-gray-600">源泉徴収処理</span>
    <span class="text-gray-400 mx-2">/</span>
    <span class="text-gray-900 font-semibold">ステップ5: 納付書を作成（翌月10日まで）</span>
  </div>

  <!-- ページヘッダー -->
  <div class="bg-gradient-to-r from-green-600 to-green-700 rounded-lg shadow-lg p-6 mb-8 text-white">
    <h1 class="text-3xl font-bold mb-2">源泉徴収処理</h1>
    <p class="text-green-100">給与計算期間: <%= @period %></p>
  </div>

  <!-- ステップインジケーター -->
  <div class="mb-8">
    <div class="flex items-center justify-between">
      <div class="flex items-center flex-1">
        <div class="flex items-center justify-center w-10 h-10 rounded-full bg-green-600 text-white font-bold">✓</div>
        <div class="flex-1 h-1 bg-green-600 mx-2"></div>
      </div>
      <div class="flex items-center flex-1">
        <div class="flex items-center justify-center w-10 h-10 rounded-full bg-green-600 text-white font-bold">✓</div>
        <div class="flex-1 h-1 bg-green-600 mx-2"></div>
      </div>
      <div class="flex items-center flex-1">
        <div class="flex items-center justify-center w-10 h-10 rounded-full bg-green-600 text-white font-bold">✓</div>
        <div class="flex-1 h-1 bg-green-600 mx-2"></div>
      </div>
      <div class="flex items-center flex-1">
        <div class="flex items-center justify-center w-10 h-10 rounded-full bg-green-600 text-white font-bold">✓</div>
        <div class="flex-1 h-1 bg-green-600 mx-2"></div>
      </div>
      <div class="flex items-center flex-1">
        <div class="flex items-center justify-center w-10 h-10 rounded-full bg-green-600 text-white font-bold">5</div>
        <div class="flex-1 h-1 bg-gray-300 mx-2"></div>
      </div>
      <div class="flex items-center">
        <div class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-300 text-gray-600 font-bold">6</div>
      </div>
    </div>
    <div class="flex justify-between mt-2 text-xs text-gray-600">
      <span class="flex-1 text-center text-gray-400">課税対象額算出</span>
      <span class="flex-1 text-center text-gray-400">扶養控除反映</span>
      <span class="flex-1 text-center text-gray-400">税額表適用</span>
      <span class="flex-1 text-center text-gray-400">所得税計算</span>
      <span class="flex-1 text-center font-semibold text-green-600">納付書作成</span>
      <span class="flex-1 text-center">年末調整精算</span>
    </div>
  </div>

  <!-- 納付書情報 -->
  <div class="bg-white rounded-lg shadow-lg overflow-hidden mb-8 border-2 border-red-200">
    <div class="bg-red-50 px-6 py-4 border-b border-red-200">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-2xl font-bold text-gray-900">源泉所得税 納付書</h2>
          <p class="text-sm text-gray-600 mt-1">所得税徴収高計算書（給与所得・退職所得等の所得税徴収高計算書）</p>
        </div>
        <span class="inline-flex items-center px-4 py-2 rounded-full text-lg font-bold bg-red-600 text-white">
          納付期限: <%= @payment_slip[:payment_deadline] %>
        </span>
      </div>
    </div>

    <div class="p-8">
      <div class="grid grid-cols-2 gap-8 mb-8">
        <!-- 左側：納付書基本情報 -->
        <div class="space-y-6">
          <div class="bg-gray-50 rounded-lg p-6">
            <h3 class="text-lg font-bold text-gray-900 mb-4 border-b border-gray-300 pb-2">納付書情報</h3>
            <div class="space-y-3">
              <div class="flex justify-between">
                <span class="text-sm text-gray-600">納付書番号:</span>
                <span class="text-sm font-bold text-gray-900"><%= @payment_slip[:slip_number] %></span>
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-600">課税期間:</span>
                <span class="text-sm font-bold text-gray-900"><%= @payment_slip[:tax_period] %></span>
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-600">従業員数:</span>
                <span class="text-sm font-bold text-gray-900"><%= @payment_slip[:number_of_employees] %>名</span>
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-600">納付方法:</span>
                <span class="text-sm font-bold text-blue-600"><%= @payment_slip[:payment_method] %></span>
              </div>
            </div>
          </div>

          <div class="bg-blue-50 rounded-lg p-6 border border-blue-200">
            <h3 class="text-lg font-bold text-gray-900 mb-4 border-b border-blue-300 pb-2">会社情報</h3>
            <div class="space-y-3">
              <div>
                <div class="text-xs text-gray-600 mb-1">会社名</div>
                <div class="text-sm font-bold text-gray-900"><%= @payment_slip[:company_name] %></div>
              </div>
              <div>
                <div class="text-xs text-gray-600 mb-1">所在地</div>
                <div class="text-sm text-gray-900"><%= @payment_slip[:company_address] %></div>
              </div>
              <div>
                <div class="text-xs text-gray-600 mb-1">管轄税務署</div>
                <div class="text-sm font-bold text-gray-900"><%= @payment_slip[:tax_office] %></div>
              </div>
            </div>
          </div>
        </div>

        <!-- 右側：納付額 -->
        <div class="flex flex-col justify-center">
          <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-lg p-8 border-2 border-red-300 shadow-lg">
            <div class="text-center mb-6">
              <div class="text-sm text-gray-600 mb-2">納付税額</div>
              <div class="text-6xl font-bold text-red-600 mb-2">
                ¥<%= number_with_delimiter(@payment_slip[:total_amount]) %>
              </div>
              <div class="text-xs text-gray-600">(復興特別所得税を含む)</div>
            </div>

            <div class="bg-white rounded-lg p-4 shadow-sm">
              <div class="text-center">
                <div class="text-xs text-gray-600 mb-1">対象従業員数</div>
                <div class="text-3xl font-bold text-gray-900">
                  <%= @payment_slip[:number_of_employees] %><span class="text-lg text-gray-600">名</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 税区分別内訳 -->
      <div class="bg-gray-50 rounded-lg p-6">
        <h3 class="text-lg font-bold text-gray-900 mb-4">税区分別内訳</h3>
        <div class="grid grid-cols-2 gap-4">
          <div class="bg-white rounded-lg p-4 border border-blue-200">
            <div class="flex items-center justify-between mb-2">
              <span class="text-sm font-semibold text-gray-700">甲欄適用者（主たる給与）</span>
              <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800">
                甲欄
              </span>
            </div>
            <div class="flex justify-between items-end">
              <div>
                <div class="text-xs text-gray-600">人数</div>
                <div class="text-2xl font-bold text-gray-900"><%= @monthly_breakdown[:tax_category_breakdown][:kou_column][:count] %>名</div>
              </div>
              <div class="text-right">
                <div class="text-xs text-gray-600">税額</div>
                <div class="text-2xl font-bold text-blue-600">¥<%= number_with_delimiter(@monthly_breakdown[:tax_category_breakdown][:kou_column][:amount]) %></div>
              </div>
            </div>
          </div>

          <div class="bg-white rounded-lg p-4 border border-orange-200">
            <div class="flex items-center justify-between mb-2">
              <span class="text-sm font-semibold text-gray-700">乙欄適用者（従たる給与）</span>
              <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-orange-100 text-orange-800">
                乙欄
              </span>
            </div>
            <div class="flex justify-between items-end">
              <div>
                <div class="text-xs text-gray-600">人数</div>
                <div class="text-2xl font-bold text-gray-900"><%= @monthly_breakdown[:tax_category_breakdown][:otsu_column][:count] %>名</div>
              </div>
              <div class="text-right">
                <div class="text-xs text-gray-600">税額</div>
                <div class="text-2xl font-bold text-orange-600">¥<%= number_with_delimiter(@monthly_breakdown[:tax_category_breakdown][:otsu_column][:amount]) %></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 納付履歴 -->
  <div class="bg-white rounded-lg shadow-md overflow-hidden mb-8">
    <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
      <h2 class="text-xl font-bold text-gray-900">過去の納付履歴</h2>
      <p class="text-sm text-gray-600 mt-1">直近3ヶ月の源泉所得税納付状況</p>
    </div>

    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">対象月</th>
            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">納付税額</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">納付日</th>
            <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">納付状況</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% @payment_history.each do |history| %>
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"><%= history[:month] %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-right font-semibold text-gray-900">
                ¥<%= number_with_delimiter(history[:amount]) %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= history[:paid_date] %></td>
              <td class="px-6 py-4 whitespace-nowrap text-center">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  <%= history[:status] %>
                </span>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- 注意事項 -->
  <div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-8">
    <div class="flex items-start">
      <svg class="w-6 h-6 text-red-600 mr-3 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <div>
        <h3 class="text-lg font-bold text-red-900 mb-2">納付期限について</h3>
        <ul class="space-y-2 text-sm text-red-900">
          <li class="flex items-start">
            <span class="text-red-600 mr-2">•</span>
            <span><strong>原則:</strong> 給与支払月の翌月10日までに納付</span>
          </li>
          <li class="flex items-start">
            <span class="text-red-600 mr-2">•</span>
            <span><strong>納期の特例:</strong> 給与の支給人員が常時10人未満の源泉徴収義務者は、年2回（1月・7月）の納付が可能</span>
          </li>
          <li class="flex items-start">
            <span class="text-red-600 mr-2">•</span>
            <span><strong>期限日が土日祝日の場合:</strong> その翌営業日が納付期限となります</span>
          </li>
          <li class="flex items-start">
            <span class="text-red-600 mr-2">•</span>
            <span><strong>延滞税:</strong> 納付期限を過ぎると延滞税が課されます</span>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- アクションボタン -->
  <div class="flex justify-between items-center">
    <%= link_to withholding_tax_step4_admin_accounting_insurance_path(@period), class: "px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium" do %>
      ← 前へ
    <% end %>
    <%= button_to execute_withholding_tax_step5_admin_accounting_insurance_path(@period), method: :post, class: "px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium shadow-md" do %>
      次へ: 年末調整について →
    <% end %>
  </div>
</div>
